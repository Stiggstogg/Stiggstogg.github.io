var Lt=Object.defineProperty;var St=(s,t,e)=>t in s?Lt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(St(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const n of h)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(h){const n={};return h.integrity&&(n.integrity=h.integrity),h.referrerPolicy&&(n.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?n.credentials="include":h.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(h){if(h.ep)return;h.ep=!0;const n=e(h);fetch(h.href,n)}})();/**
 * @preserve
 * Kontra.js v9.0.0
 */let J=()=>{},Ct="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function ot(s,t){let e=t.parentNode;if(s.setAttribute("data-kontra",""),e){let i=e.querySelector("[data-kontra]:last-of-type")||t;e.insertBefore(s,i.nextSibling)}else document.body.appendChild(s)}function ft(s,t){let e=s.indexOf(t);if(e!=-1)return s.splice(e,1),!0}let M={};function X(s,t){M[s]=M[s]||[],M[s].push(t)}function kt(s,t){M[s]=(M[s]||[]).filter(e=>e!=t)}function P(s,...t){(M[s]||[]).map(e=>e(...t))}let b,U,at={get(s,t){return t=="_proxy"?!0:J}};function xt(){return b}function W(){return U}function vt(s,{contextless:t=!1}={}){if(b=document.getElementById(s)||s||document.querySelector("canvas"),t&&(b=b||new Proxy({},at)),!b)throw Error("You must provide a canvas element for the game");return U=b.getContext("2d")||new Proxy({},at),U.imageSmoothingEnabled=!1,P("init"),{canvas:b,context:U}}function At(s,t){let e=Math.sin(t),i=Math.cos(t);return{x:s.x*i-s.y*e,y:s.x*e+s.y*i}}function it(s,t,e){return Math.min(Math.max(s,e),t)}function Wt(s,t){return[s,t]=[s,t].map(e=>wt(e)),s.x<t.x+t.width&&s.x+s.width>t.x&&s.y<t.y+t.height&&s.y+s.height>t.y}function wt(s){let{x:t=0,y:e=0,width:i,height:h}=s.world||s;return s.mapwidth&&(i=s.mapwidth,h=s.mapheight),s.anchor&&(t-=i*s.anchor.x,e-=h*s.anchor.y),i<0&&(t+=i,i*=-1),h<0&&(e+=h,h*=-1),{x:t,y:e,width:i,height:h}}class T{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new T(this.x+t.x,this.y+t.y,this)}subtract(t){return new T(this.x-t.x,this.y-t.y,this)}scale(t){return new T(this.x*t,this.y*t)}normalize(t=this.length()||1){return new T(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,h){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?it(this._a,this._d,t):t}set y(t){this._y=this._c?it(this._b,this._e,t):t}}function j(){return new T(...arguments)}class Ht{constructor(t){return this.init(t)}init(t={}){this.position=j(),this.velocity=j(),this.acceleration=j(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class $ extends Ht{init({width:t=0,height:e=0,context:i=W(),render:h=this.draw,update:n=this.advance,children:r=[],anchor:a={x:0,y:0},opacity:x=1,rotation:c=0,scaleX:u=1,scaleY:m=1,...g}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:x,rotation:c,scaleX:u,scaleY:m,...g}),this._di=!0,this._uw(),this.addChild(r),this._rf=h,this._uf=n,X("init",()=>{this.context??(this.context=W())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map(n=>n.render&&n.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:h=0,_wsx:n=1,_wsy:r=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=n*this.scaleX,this._wsy=r*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*r,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=h+this.rotation;let{x:a,y:x}=At({x:this._wx,y:this._wy},h);this._wx=a,this._wy=x,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||J,e._pc()})}removeChild(...t){t.flat().map(e=>{ft(this.children,e)&&(e.parent=null,e._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=it(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class mt extends ${init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...h}={}){super.init({image:t,width:e,height:i,...h})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function tt(){return new mt(...arguments)}let Yt=/(\d+)(\w+)/;function Rt(s){if(!s)return{computed:0};let t=s.match(Yt),e=+t[1],i=t[2];return{size:e,unit:i,computed:e}}class bt extends ${init({text:t="",textAlign:e="",lineHeight:i=1,font:h=(r=>(r=W())==null?void 0:r.font)(),...n}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:h,...n}),this.context&&this._p(),X("init",()=>{this.font??(this.font=W().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Rt(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(i=>{let h=i.split(" "),n=h.shift(),r=n;h.map(a=>{r+=" "+a,t.measureText(r).width>this._fw&&(this._s.push(n),r=a),n=r}),this._s.push(r)}),!this._s.length&&this.text.includes(`
`)){let i=0;e.map(h=>{this._s.push(h),i=Math.max(i,t.measureText(h).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((h,n)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(h,t,this._fs*this.lineHeight*n)),i.fillText(h,t,this._fs*this.lineHeight*n)})}}function f(){return new bt(...arguments)}let F=new WeakMap,lt={},ht={},yt={0:"left",1:"middle",2:"right"};function Gt(s,t){let{x:e,y:i,width:h,height:n}=wt(s);do e-=s.sx||0,i-=s.sy||0;while(s=s.parent);let r=t.x-Math.max(e,Math.min(t.x,e+h)),a=t.y-Math.max(i,Math.min(t.y,i+n));return r*r+a*a<t.radius*t.radius}function Bt(s){let t=s._lf.length?s._lf:s._cf;for(let e=t.length-1;e>=0;e--){let i=t[e];if(i.collidesWithPointer?i.collidesWithPointer(s):Gt(i,s))return i}}function S(s,t){return parseFloat(s.getPropertyValue(t))||0}function Tt(s){let{canvas:t,_s:e}=s,i=t.getBoundingClientRect(),h=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],n=parseFloat(h[0]),r=parseFloat(h[3]),a=(S(e,"border-left-width")+S(e,"border-right-width"))*n,x=(S(e,"border-top-width")+S(e,"border-bottom-width"))*r,c=(S(e,"padding-left")+S(e,"padding-right"))*n,u=(S(e,"padding-top")+S(e,"padding-bottom"))*r;return{scaleX:(i.width-a-c)/t.width,scaleY:(i.height-x-u)/t.height,offsetX:i.left+(S(e,"border-left-width")+S(e,"padding-left"))*n,offsetY:i.top+(S(e,"border-top-width")+S(e,"padding-top"))*r}}function ct(s){let t=s.button!=null?yt[s.button]:"left";ht[t]=!0,nt(s,"onDown")}function et(s){let t=s.button!=null?yt[s.button]:"left";ht[t]=!1,nt(s,"onUp")}function dt(s){nt(s,"onOver")}function Et(s){let t=F.get(s.target);t._oo=null,ht={}}function ut(s,t,e){let i=Bt(s);i&&i[t]&&i[t](e),lt[t]&&lt[t](e,i),t=="onOver"&&(i!=s._oo&&s._oo&&s._oo.onOut&&s._oo.onOut(e),s._oo=i)}function nt(s,t){s.preventDefault();let e=s.target,i=F.get(e),{scaleX:h,scaleY:n,offsetX:r,offsetY:a}=Tt(i);s.type.includes("touch")?(Array.from(s.touches).map(({clientX:c,clientY:u,identifier:m})=>{let g=i.touches[m];g||(g=i.touches[m]={start:{x:(c-r)/h,y:(u-a)/n}},i.touches.length++),g.changed=!1}),Array.from(s.changedTouches).map(({clientX:c,clientY:u,identifier:m})=>{let g=i.touches[m];g.changed=!0,g.x=i.x=(c-r)/h,g.y=i.y=(u-a)/n,ut(i,t,s),P("touchChanged",s,i.touches),t=="onUp"&&(delete i.touches[m],i.touches.length--,i.touches.length||P("touchEnd"))})):(i.x=(s.clientX-r)/h,i.y=(s.clientY-a)/n,ut(i,t,s))}function Mt({radius:s=5,canvas:t=xt()}={}){let e=F.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:s,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},F.set(t,e)}return t.addEventListener("mousedown",ct),t.addEventListener("touchstart",ct),t.addEventListener("mouseup",et),t.addEventListener("touchend",et),t.addEventListener("touchcancel",et),t.addEventListener("blur",Et),t.addEventListener("mousemove",dt),t.addEventListener("touchmove",dt),e._t||(e._t=!0,X("tick",()=>{e._lf.length=0,e._cf.map(i=>{e._lf.push(i)}),e._cf.length=0})),e}function z(...s){s.flat().map(t=>{let e=t.context?t.context.canvas:xt(),i=F.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))})}function Ot(s){let t=s.canvas;s.clearRect(0,0,t.width,t.height)}function Xt({fps:s=60,clearCanvas:t=!0,update:e=J,render:i,context:h=W(),blur:n=!1}={}){if(!i)throw Error("You must provide a render() function");let r=0,a=1e3/s,x=1/s,c=t?Ot:J,u,m,g,w,L,k=!0;n||(window.addEventListener("focus",()=>{k=!0}),window.addEventListener("blur",()=>{k=!1})),X("init",()=>{L.context??(L.context=W())});function v(){if(m=requestAnimationFrame(v),!!k&&(g=performance.now(),w=g-u,u=g,!(w>1e3))){for(P("tick"),r+=w;r>=a;)L.update(x),r-=a;c(L.context),L.render()}}return L={update:e,render:i,isStopped:!0,context:h,start(){u=performance.now(),this.isStopped=!1,requestAnimationFrame(v)},stop(){this.isStopped=!0,cancelAnimationFrame(m)},_frame:v,set _last(p){u=p}},L}let Nt={set(s,t,e){return t.startsWith("_")||(s._d=!0),Reflect.set(s,t,e)}},pt={start(s){return s?1:0},center(){return .5},end(s){return s?0:1}};class Dt extends ${init({flow:t="column",align:e="start",justify:i="start",colGap:h=0,rowGap:n=0,numCols:r=1,dir:a="",breakpoints:x=[],...c}={}){return super.init({flow:t,align:e,justify:i,colGap:h,rowGap:n,numCols:r,dir:a,breakpoints:x,...c}),this._p(),new Proxy(this,Nt)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(p=>{p.metric.call(this)&&this._b!==p&&(this._b=p,p.callback.call(this))});let t=this._g=[],e=this._cw=[],i=this._rh=[],h=this.children,n=this._nc=this.flow=="column"?1:this.flow=="row"?h.length:this.numCols,r=0,a=0;for(let p=0,y;y=h[p];p++){t[r]=t[r]||[],y._p&&y._p();let{width:q,height:_}=y.world||y;i[r]=Math.max(i[r]||0,_);let C=y.colSpan||1,B=C;do e[a]=Math.max(e[a]||0,q/B),t[r][a]=y;while(a++<=n&&--C);a>=n&&(a=0,r++)}for(;a>0&&a<n;)t[r][a++]=!1;let x=t.length,c=[].concat(this.colGap),u=[].concat(this.rowGap);this._w=e.reduce((p,y)=>p+=y,0);for(let p=0;p<n-1;p++)this._w+=c[p%c.length];this._h=i.reduce((p,y)=>p+=y,0);for(let p=0;p<x-1;p++)this._h+=u[p%u.length];this._uw();let g=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=g,g&&(this._g=t.map(p=>p.reverse()),this._cw=e.reverse(),c=c.reverse());let w=-this.anchor.y*this.height,L=[],k=[].concat(this.justify),v=[].concat(this.align);this._g.map((p,y)=>{let q=-this.anchor.x*this.width;p.map((_,C)=>{if(_&&!L.includes(_)){L.push(_);let B=pt[_.justifySelf||k[C%k.length]](this._rtl),I=pt[_.alignSelf||v[y%v.length]](),Q=_.colSpan||1,rt=e[C];if(Q>1&&C+Q<=this._nc)for(let A=1;A<Q;A++)rt+=e[C+A]+c[(C+A)%c.length];let H=rt*B,Y=i[y]*I,N=0,D=0,{width:Z,height:V}=_.world||_;if(_.anchor&&(N=_.anchor.x,D=_.anchor.y),B==0)H=H+Z*N;else if(B==.5){let A=N<.5?-1:N==.5?0:1;H=H+A*Z*B}else H=H-Z*(1-N);if(I==0)Y=Y+V*D;else if(I==.5){let A=D<.5?-1:D==.5?0:1;Y=Y+A*V*I}else Y=Y-V*(1-D);_.x=q+H,_.y=w+Y}q+=e[C]+c[C%c.length]}),w+=i[y]+u[y%u.length]})}}function O(){return new Dt(...arguments)}function st(s){let t=[];return s._dn?t.push(s._dn):s.children&&s.children.map(e=>{t=t.concat(st(e))}),t}class K{constructor({id:t,name:e=t,objects:i=[],context:h=W(),cullObjects:n=!0,cullFunction:r=Wt,sortFunction:a,...x}){this._o=[],Object.assign(this,{id:t,name:e,context:h,cullObjects:n,cullFunction:r,sortFunction:a,...x});let c=this._dn=document.createElement("section");c.tabIndex=-1,c.style=Ct,c.id=t,c.setAttribute("aria-label",e);let u=this;class m extends ${set x(w){u.sx=w-this.centerX,super.x=w}get x(){return super.x}set y(w){u.sy=w-this.centerY,super.y=w}get y(){return super.y}}this.camera=new m({context:h,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??(this.context=W());let g=this.context.canvas,{width:w,height:L}=g,k=w/2,v=L/2;Object.assign(this.camera,{centerX:k,centerY:v,x:k,y:v,width:w,height:L}),this._dn.isConnected||ot(this._dn,g)},this.context&&this._i(),X("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,st(e).map(i=>{this._dn.appendChild(i)})})}remove(...t){t.flat().map(e=>{ft(this._o,e),e.parent=null,st(e).map(i=>{ot(i,this.context)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){kt("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:i,_sy:h,camera:n,sortFunction:r,cullObjects:a,cullFunction:x}=this;e.translate(i,h);let c=t;a&&(c=c.filter(u=>x(n,u))),r&&c.sort(r),c.map(u=>u.render&&u.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:h,centerX:n,centerY:r}=e;t.save(),this._sx=n-i,this._sy=r-h,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}class Pt{constructor(){o(this,"scenes");o(this,"currentScene");this.scenes=[]}init(t){this.scenes.push(...t),this.currentScene=this.scenes[0],this.currentScene.show()}start(t){this.currentScene.hide();for(let e of this.scenes)if(e.id==t){this.currentScene=e;break}this.currentScene.show()}}class Ft extends K{constructor(t){super({id:t})}onShow(){G.start("menu")}}let d=[];d.push({font:"72px Copperplate Gothic",color:"white",anchor:{x:.5,y:.5},textAlign:"center"});d.push({font:"48px Copperplate Gothic",color:"yellow",anchor:{x:.5,y:.5},textAlign:"center"});d.push({font:"24px Copperplate Gothic",color:"white",anchor:{x:0,y:0},textAlign:"left"});d.push({font:"80px Arial",color:"white",anchor:{x:.5,y:.5},textAlign:"center"});d.push({font:"180px Arial",color:"white",anchor:{x:.5,y:.5},textAlign:"center"});d.push({font:"18px Copperplate Gothic",color:"black",anchor:{x:0,y:0},textAlign:"left"});d.push({font:"48px Copperplate Gothic",color:"Black",anchor:{x:.5,y:0},textAlign:"center"});d.push({font:"32px Copperplate Gothic",color:"Black",anchor:{x:.5,y:0},textAlign:"center"});const l={yearLength:10,gameWidth:0,gameHeight:0};class $t extends K{constructor(t){super({id:t})}onShow(){let t=f({text:"Cathedral Master Builder",...d[0]}),e=f({text:"Start",...d[1],onDown:()=>{G.start("game")}}),i=f({text:"Credits",...d[1],onDown:()=>{console.log("Credits pressed")}});const h=l.gameHeight*.1;let n=O({x:l.gameWidth/2,y:h*2,anchor:{x:.5,y:0},rowGap:[h*1.5,h,h],justify:"center",children:[t,e,i]});z(e,i),this.add(n),G.start("game")}onHide(){}update(){super.update()}render(){super.render()}}class R{constructor(t,e,i,h,n){o(this,"name");o(this,"description");o(this,"image");o(this,"compo");this.name=i,this.description=f({text:this.name,...d[2],onDown:()=>{this.click()}}),this.image=f({text:h,...d[n],onDown:()=>{this.click()}}),this.compo=O({x:l.gameWidth*t,y:l.gameHeight*e,anchor:{x:.5,y:.5},justify:"center",children:[this.image,this.description]}),z(this.description,this.image)}click(){P("click"+this.name)}tick(){console.log("tick: "+this.name)}}class gt extends ${constructor(e){super({x:e.x,y:e.y});o(this,"properties");o(this,"length");this.properties=e,this.length=this.properties.length}draw(){this.context.fillStyle=this.properties.color,this.context.beginPath(),this.context.moveTo(0,0),this.properties.horizontal?this.context.lineTo(this.properties.length,0):this.context.lineTo(0,this.properties.length),this.context.lineWidth=this.properties.width,this.context.stroke()}}class zt extends mt{constructor(e,i){super({x:0,y:0,width:l.gameWidth,height:l.gameHeight,color:"#EADDCA"});o(this,"visible");o(this,"shadow");o(this,"cover");o(this,"page");o(this,"title");o(this,"lineSeparator");o(this,"titleYear");o(this,"writingLines");o(this,"leftLines");o(this,"rightLines");o(this,"cancelBttn");this.visible=!1,this.titleYear=[],this.leftLines=e,this.rightLines=i;let h=l.gameWidth*.01,n=l.gameWidth*.01,r=9,a=[l.gameHeight*.02,l.gameHeight*.02,l.gameHeight*.12,l.gameHeight*.07];this.title=f({x:l.gameWidth/2,y:l.gameHeight*5e-4,text:"Title",...d[6]}),this.cover=tt({x:l.gameWidth*.05,y:l.gameHeight*.12,width:l.gameWidth*.9,height:l.gameHeight*.85,color:"#4A0404"}),this.shadow=tt({x:this.cover.x+h,y:this.cover.y+h,width:this.cover.width,height:this.cover.height,color:"black",opacity:.3}),this.page=tt({x:this.cover.x+n,y:this.cover.y+n/2,width:this.cover.width-2*n,height:this.cover.height-n,color:"#E1C16E"}),this.lineSeparator=new gt({x:this.width/2,y:this.page.y,length:this.page.height,horizontal:!1,width:1,color:"black"}),this.titleYear.push(f({x:this.page.x+this.page.width*.25,y:this.page.y+a[0],text:"1213",...d[7]})),this.titleYear.push(f({x:this.page.x+this.page.width*.75,y:this.titleYear[0].y,text:"1213",...d[7]})),this.cancelBttn=f({x:l.gameWidth*.96,y:l.gameWidth*.02,text:"✖️",...d[6],anchor:{x:.5,y:.5},onDown:()=>{this.hide()}}),z(this.cancelBttn),this.addChild([this.title,this.cover,this.shadow,this.page,this.lineSeparator,...this.titleYear,this.cancelBttn]);let x=[],c=r,u=1,m=this.page.x+2*n,g=this.page.width/2-4*n;this.leftLines&&this.rightLines?(c=2*r,u=2):!this.leftLines&&this.rightLines&&(m=m+g+4*n);for(let w=0;w<c;w++)x.push(new gt({x:0,y:0,length:g,horizontal:!0,width:1,color:"red"}));this.writingLines=O({x:m,y:this.titleYear[0].y+this.titleYear[0].height+a[2],rowGap:a[3],colGap:x[0].length+4*n,numCols:u,flow:"grid",justify:"center",children:x}),(this.leftLines||this.rightLines)&&this.addChild(this.writingLines)}render(){this.visible&&super.render()}show(){this.visible=!0}hide(){this.visible=!1}}class qt extends zt{constructor(){super(!0,!0);o(this,"textLeft");o(this,"textLeftNumRows");o(this,"textLeftNumCols");o(this,"textRight");o(this,"textRightNumRows");o(this,"textRightNumCols");o(this,"textGridLeft");o(this,"textGridRight");o(this,"nextButton");o(this,"previousButton");this.title.text="Yearbook: Bakery 🥖";let e=.01*l.gameWidth;this.previousButton=f({x:this.page.x+e,y:this.page.y+e,text:"⬅️",...d[6],anchor:{x:0,y:0},onDown:()=>{this.pageChange()}}),this.nextButton=f({x:this.page.x+this.page.width-e,y:this.page.y+e,text:"➡️",...d[6],anchor:{x:1,y:0},onDown:()=>{this.pageChange()}}),z(this.previousButton,this.nextButton),this.textLeft=[],this.textLeftNumRows=9,this.textLeftNumCols=5,this.textRight=[],this.textRightNumRows=9,this.textRightNumCols=1;for(let n=0;n<this.textLeftNumRows*this.textLeftNumCols;n++)this.textLeft.push(f({x:0,y:0,text:n.toString(),...d[5]}));let i=this.writingLines.y-Number(this.writingLines.rowGap)*.75,h=Number(this.writingLines.rowGap)-this.textLeft[0].height;this.textGridLeft=O({x:this.writingLines.x,y:i,rowGap:h,colGap:l.gameWidth*.03,numCols:this.textLeftNumCols,flow:"grid",justify:["start","end","end","end","end","end","end"],children:this.textLeft});for(let n=0;n<this.textRightNumRows*this.textRightNumCols;n++)this.textRight.push(f({x:0,y:0,text:n.toString(),...d[5]}));this.textGridRight=O({x:this.writingLines.x+Number(this.writingLines.colGap),y:i,rowGap:h,flow:"column",justify:["start"],children:this.textRight}),this.addChild([this.textGridLeft,this.textGridRight,this.previousButton,this.nextButton])}writeLine(e,i,h){let n=this.textLeft,r=this.textLeftNumCols;e||(n=this.textRight,r=this.textRightNumCols);for(let a=0;a<h.length;a++)n[i*r+a].text=h[a]}pageChange(){this.writeLine(!0,0,["Production:"," "," "," "," "]),this.writeLine(!0,1,["William","🪙","🥖","⚒️","⛪"]),this.writeLine(!0,2,["Etienne","-300","+400","-402","+400"]),this.writeLine(!0,3,["Jim","-300","+400","-402","+400"]),this.writeLine(!0,4,["Guillaume","-300","+400","-402","+400"]),this.writeLine(!0,5,["Stephen","-300","+400","-402","+400"]),this.writeLine(!0,6,["Pierre","-300","+400","-402","+400"]),this.writeLine(!0,7,["","","","",""]),this.writeLine(!0,8,["Overall:","-300","+400","-102","+400"])}}class It extends K{constructor(e){super({id:e});o(this,"money");o(this,"stone");o(this,"iron");o(this,"bread");o(this,"tools");o(this,"places");o(this,"market");o(this,"town");o(this,"year");o(this,"progress");o(this,"tickLength");o(this,"lastTickTime");o(this,"nextTick");o(this,"yearBook");this.places=[]}onShow(){this.year=f({text:"1213",...d[0],x:l.gameWidth*.55,y:l.gameHeight*.1}),this.money=f({text:"🪙: 0 FRT",...d[2]}),this.stone=f({text:"🪨: 0 kg",...d[2]}),this.iron=f({text:"🧲: 0 kg",...d[2]}),this.bread=f({text:"🥖: 0 pcs",...d[2]}),this.tools=f({text:"⚒️: 0 pcs",...d[2]});let e=O({x:l.gameWidth*.01,y:l.gameWidth*.01,anchor:{x:0,y:0},rowGap:l.gameHeight*.02,children:[this.money,this.stone,this.iron,this.bread,this.tools]});this.places.push(new R(.25,.75,"Bishop","✝️",3)),this.places.push(new R(.37,.35,"Bakery","🥖",3)),this.places.push(new R(.73,.35,"Blacksmith","⚒️",3)),this.places.push(new R(.85,.75,"Masonry","🪨",3)),this.places.push(new R(.55,.63,"Cathedral","⛪",4)),this.town=new R(.05,.85,"Town","🏘️",3),this.market=new R(.05,.55,"Market","🧺",3),this.progress=f({text:"100 %",...d[1],x:l.gameWidth*.55,y:l.gameHeight*.9}),this.progress.color="white",this.yearBook=new qt,this.add([this.year,e,this.market.compo,this.town.compo,this.progress]);for(let i of this.places)this.add(i.compo);this.add([this.yearBook]),X("clickCathedral",()=>{this.yearBook.show()}),this.tickLength=Math.round(l.yearLength*1e3/this.places.length),this.lastTickTime=Date.now()-this.tickLength,this.nextTick=0}onHide(){}update(){super.update(),Date.now()-this.lastTickTime>this.tickLength&&(this.lastTickTime=Date.now(),this.places[this.nextTick].tick(),this.nextTick++,this.nextTick>=this.places.length&&(this.nextTick=0,this.year.text=String(Number(this.year.text)+1)))}render(){super.render()}}class Ut extends K{constructor(t){super({id:t})}onShow(){let t=f({text:"You WON!",...d[1],x:l.gameWidth/2,y:l.gameHeight/2,onDown:()=>{G.start("menu")}});z(t),this.add(t)}onHide(){}update(){super.update()}render(){super.render()}}let{canvas:E,context:te}=vt();Mt();l.gameWidth=E.width;l.gameHeight=E.height;addEventListener("resize",_t);_t();const Jt=new Ft("loading"),Kt=new $t("menu"),Qt=new It("game"),Zt=new Ut("win");let G=new Pt;G.init([Jt,Kt,Qt,Zt]);let Vt=Xt({update:function(){G.currentScene.update()},render:function(){G.currentScene.render()}});Vt.start();function _t(){let s=l.gameWidth/l.gameHeight;window.innerWidth/s>window.innerHeight?(E.style.height=String(window.innerHeight)+"px",E.style.width=String(window.innerHeight*s)+"px"):(E.style.width=String(window.innerWidth)+"px",E.style.height=String(window.innerWidth/s)+"px")}
