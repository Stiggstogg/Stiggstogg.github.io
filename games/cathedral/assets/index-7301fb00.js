var Wt=Object.defineProperty;var Et=(h,t,e)=>t in h?Wt(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var r=(h,t,e)=>(Et(h,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();/**
 * @preserve
 * Kontra.js v9.0.0
 */let Z=()=>{},Rt="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function gt(h,t){let e=t.parentNode;if(h.setAttribute("data-kontra",""),e){let i=e.querySelector("[data-kontra]:last-of-type")||t;e.insertBefore(h,i.nextSibling)}else document.body.appendChild(h)}function Bt(h,t){let e=h.indexOf(t);if(e!=-1)return h.splice(e,1),!0}let U={};function T(h,t){U[h]=U[h]||[],U[h].push(t)}function Ht(h,t){U[h]=(U[h]||[]).filter(e=>e!=t)}function S(h,...t){(U[h]||[]).map(e=>e(...t))}let G,Q,wt={get(h,t){return t=="_proxy"?!0:Z}};function vt(){return G}function A(){return Q}function Mt(h,{contextless:t=!1}={}){if(G=document.getElementById(h)||h||document.querySelector("canvas"),t&&(G=G||new Proxy({},wt)),!G)throw Error("You must provide a canvas element for the game");return Q=G.getContext("2d")||new Proxy({},wt),Q.imageSmoothingEnabled=!1,S("init"),{canvas:G,context:Q}}function At(h,t){let e=Math.sin(t),i=Math.cos(t);return{x:h.x*i-h.y*e,y:h.x*e+h.y*i}}function at(h,t,e){return Math.min(Math.max(h,e),t)}function Ct(h,t){return[h,t]=[h,t].map(e=>Tt(e)),h.x<t.x+t.width&&h.x+h.width>t.x&&h.y<t.y+t.height&&h.y+h.height>t.y}function Tt(h){let{x:t=0,y:e=0,width:i,height:s}=h.world||h;return h.mapwidth&&(i=h.mapwidth,s=h.mapheight),h.anchor&&(t-=i*h.anchor.x,e-=s*h.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}class X{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new X(this.x+t.x,this.y+t.y,this)}subtract(t){return new X(this.x-t.x,this.y-t.y,this)}scale(t){return new X(this.x*t,this.y*t)}normalize(t=this.length()||1){return new X(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?at(this._a,this._d,t):t}set y(t){this._y=this._c?at(this._b,this._e,t):t}}function st(){return new X(...arguments)}class Pt{constructor(t){return this.init(t)}init(t={}){this.position=st(),this.velocity=st(),this.acceleration=st(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class J extends Pt{init({width:t=0,height:e=0,context:i=A(),render:s=this.draw,update:n=this.advance,children:o=[],anchor:c={x:0,y:0},opacity:l=1,rotation:d=0,scaleX:f=1,scaleY:g=1,...x}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:c,opacity:l,rotation:d,scaleX:f,scaleY:g,...x}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=n,T("init",()=>{this.context??(this.context=A())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map(n=>n.render&&n.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:n=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=n*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:c,y:l}=At({x:this._wx,y:this._wy},s);this._wx=c,this._wy=l,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Z,e._pc()})}removeChild(...t){t.flat().map(e=>{Bt(this.children,e)&&(e.parent=null,e._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=at(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class F extends J{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function D(){return new F(...arguments)}let Yt=/(\d+)(\w+)/;function Vt(h){if(!h)return{computed:0};let t=h.match(Yt),e=+t[1],i=t[2];return{size:e,unit:i,computed:e}}class Gt extends J{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=(o=>(o=A())==null?void 0:o.font)(),...n}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...n}),this.context&&this._p(),T("init",()=>{this.font??(this.font=A().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Vt(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(i=>{let s=i.split(" "),n=s.shift(),o=n;s.map(c=>{o+=" "+c,t.measureText(o).width>this._fw&&(this._s.push(n),o=c),n=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let i=0;e.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((s,n)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*n)),i.fillText(s,t,this._fs*this.lineHeight*n)})}}function p(){return new Gt(...arguments)}let K=new WeakMap,xt={},ut={},St={0:"left",1:"middle",2:"right"};function Dt(h,t){let{x:e,y:i,width:s,height:n}=Tt(h);do e-=h.sx||0,i-=h.sy||0;while(h=h.parent);let o=t.x-Math.max(e,Math.min(t.x,e+s)),c=t.y-Math.max(i,Math.min(t.y,i+n));return o*o+c*c<t.radius*t.radius}function Ft(h){let t=h._lf.length?h._lf:h._cf;for(let e=t.length-1;e>=0;e--){let i=t[e];if(i.collidesWithPointer?i.collidesWithPointer(h):Dt(i,h))return i}}function v(h,t){return parseFloat(h.getPropertyValue(t))||0}function jt(h){let{canvas:t,_s:e}=h,i=t.getBoundingClientRect(),s=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],n=parseFloat(s[0]),o=parseFloat(s[3]),c=(v(e,"border-left-width")+v(e,"border-right-width"))*n,l=(v(e,"border-top-width")+v(e,"border-bottom-width"))*o,d=(v(e,"padding-left")+v(e,"padding-right"))*n,f=(v(e,"padding-top")+v(e,"padding-bottom"))*o;return{scaleX:(i.width-c-d)/t.width,scaleY:(i.height-l-f)/t.height,offsetX:i.left+(v(e,"border-left-width")+v(e,"padding-left"))*n,offsetY:i.top+(v(e,"border-top-width")+v(e,"padding-top"))*o}}function yt(h){let t=h.button!=null?St[h.button]:"left";ut[t]=!0,dt(h,"onDown")}function ht(h){let t=h.button!=null?St[h.button]:"left";ut[t]=!1,dt(h,"onUp")}function mt(h){dt(h,"onOver")}function Ot(h){let t=K.get(h.target);t._oo=null,ut={}}function bt(h,t,e){let i=Ft(h);i&&i[t]&&i[t](e),xt[t]&&xt[t](e,i),t=="onOver"&&(i!=h._oo&&h._oo&&h._oo.onOut&&h._oo.onOut(e),h._oo=i)}function dt(h,t){h.preventDefault();let e=h.target,i=K.get(e),{scaleX:s,scaleY:n,offsetX:o,offsetY:c}=jt(i);h.type.includes("touch")?(Array.from(h.touches).map(({clientX:d,clientY:f,identifier:g})=>{let x=i.touches[g];x||(x=i.touches[g]={start:{x:(d-o)/s,y:(f-c)/n}},i.touches.length++),x.changed=!1}),Array.from(h.changedTouches).map(({clientX:d,clientY:f,identifier:g})=>{let x=i.touches[g];x.changed=!0,x.x=i.x=(d-o)/s,x.y=i.y=(f-c)/n,bt(i,t,h),S("touchChanged",h,i.touches),t=="onUp"&&(delete i.touches[g],i.touches.length--,i.touches.length||S("touchEnd"))})):(i.x=(h.clientX-o)/s,i.y=(h.clientY-c)/n,bt(i,t,h))}function Nt({radius:h=5,canvas:t=vt()}={}){let e=K.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:h,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},K.set(t,e)}return t.addEventListener("mousedown",yt),t.addEventListener("touchstart",yt),t.addEventListener("mouseup",ht),t.addEventListener("touchend",ht),t.addEventListener("touchcancel",ht),t.addEventListener("blur",Ot),t.addEventListener("mousemove",mt),t.addEventListener("touchmove",mt),e._t||(e._t=!0,T("tick",()=>{e._lf.length=0,e._cf.map(i=>{e._lf.push(i)}),e._cf.length=0})),e}function z(...h){h.flat().map(t=>{let e=t.context?t.context.canvas:vt(),i=K.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))})}function Xt(h){let t=h.canvas;h.clearRect(0,0,t.width,t.height)}function It({fps:h=60,clearCanvas:t=!0,update:e=Z,render:i,context:s=A(),blur:n=!1}={}){if(!i)throw Error("You must provide a render() function");let o=0,c=1e3/h,l=1/h,d=t?Xt:Z,f,g,x,b,_,L=!0;n||(window.addEventListener("focus",()=>{L=!0}),window.addEventListener("blur",()=>{L=!1})),T("init",()=>{_.context??(_.context=A())});function W(){if(g=requestAnimationFrame(W),!!L&&(x=performance.now(),b=x-f,f=x,!(b>1e3))){for(S("tick"),o+=b;o>=c;)_.update(l),o-=c;d(_.context),_.render()}}return _={update:e,render:i,isStopped:!0,context:s,start(){f=performance.now(),this.isStopped=!1,requestAnimationFrame(W)},stop(){this.isStopped=!0,cancelAnimationFrame(g)},_frame:W,set _last(w){f=w}},_}let Ut={set(h,t,e){return t.startsWith("_")||(h._d=!0),Reflect.set(h,t,e)}},kt={start(h){return h?1:0},center(){return .5},end(h){return h?0:1}};class zt extends J{init({flow:t="column",align:e="start",justify:i="start",colGap:s=0,rowGap:n=0,numCols:o=1,dir:c="",breakpoints:l=[],...d}={}){return super.init({flow:t,align:e,justify:i,colGap:s,rowGap:n,numCols:o,dir:c,breakpoints:l,...d}),this._p(),new Proxy(this,Ut)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(w=>{w.metric.call(this)&&this._b!==w&&(this._b=w,w.callback.call(this))});let t=this._g=[],e=this._cw=[],i=this._rh=[],s=this.children,n=this._nc=this.flow=="column"?1:this.flow=="row"?s.length:this.numCols,o=0,c=0;for(let w=0,m;m=s[w];w++){t[o]=t[o]||[],m._p&&m._p();let{width:j,height:k}=m.world||m;i[o]=Math.max(i[o]||0,k);let B=m.colSpan||1,y=B;do e[c]=Math.max(e[c]||0,j/y),t[o][c]=m;while(c++<=n&&--B);c>=n&&(c=0,o++)}for(;c>0&&c<n;)t[o][c++]=!1;let l=t.length,d=[].concat(this.colGap),f=[].concat(this.rowGap);this._w=e.reduce((w,m)=>w+=m,0);for(let w=0;w<n-1;w++)this._w+=d[w%d.length];this._h=i.reduce((w,m)=>w+=m,0);for(let w=0;w<l-1;w++)this._h+=f[w%f.length];this._uw();let x=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=x,x&&(this._g=t.map(w=>w.reverse()),this._cw=e.reverse(),d=d.reverse());let b=-this.anchor.y*this.height,_=[],L=[].concat(this.justify),W=[].concat(this.align);this._g.map((w,m)=>{let j=-this.anchor.x*this.width;w.map((k,B)=>{if(k&&!_.includes(k)){_.push(k);let y=kt[k.justifySelf||L[B%L.length]](this._rtl),C=kt[k.alignSelf||W[m%W.length]](),tt=k.colSpan||1,ft=e[B];if(tt>1&&B+tt<=this._nc)for(let M=1;M<tt;M++)ft+=e[B+M]+d[(B+M)%d.length];let P=ft*y,Y=i[m]*C,$=0,q=0,{width:et,height:it}=k.world||k;if(k.anchor&&($=k.anchor.x,q=k.anchor.y),y==0)P=P+et*$;else if(y==.5){let M=$<.5?-1:$==.5?0:1;P=P+M*et*y}else P=P-et*(1-$);if(C==0)Y=Y+it*q;else if(C==.5){let M=q<.5?-1:q==.5?0:1;Y=Y+M*it*C}else Y=Y-it*(1-q);k.x=j+P,k.y=b+Y}j+=e[B]+d[B%d.length]}),b+=i[m]+f[m%f.length]})}}function R(){return new zt(...arguments)}function lt(h){let t=[];return h._dn?t.push(h._dn):h.children&&h.children.map(e=>{t=t.concat(lt(e))}),t}class $t{constructor({id:t,name:e=t,objects:i=[],context:s=A(),cullObjects:n=!0,cullFunction:o=Ct,sortFunction:c,...l}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:n,cullFunction:o,sortFunction:c,...l});let d=this._dn=document.createElement("section");d.tabIndex=-1,d.style=Rt,d.id=t,d.setAttribute("aria-label",e);let f=this;class g extends J{set x(b){f.sx=b-this.centerX,super.x=b}get x(){return super.x}set y(b){f.sy=b-this.centerY,super.y=b}get y(){return super.y}}this.camera=new g({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??(this.context=A());let x=this.context.canvas,{width:b,height:_}=x,L=b/2,W=_/2;Object.assign(this.camera,{centerX:L,centerY:W,x:L,y:W,width:b,height:_}),this._dn.isConnected||gt(this._dn,x)},this.context&&this._i(),T("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,lt(e).map(i=>{this._dn.appendChild(i)})})}remove(...t){t.flat().map(e=>{Bt(this._o,e),e.parent=null,lt(e).map(i=>{gt(i,this.context)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){Ht("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:n,sortFunction:o,cullObjects:c,cullFunction:l}=this;e.translate(i,s);let d=t;c&&(d=d.filter(f=>l(n,f))),o&&d.sort(o),d.map(f=>f.render&&f.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:n,centerY:o}=e;t.save(),this._sx=n-i,this._sy=o-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}let u=[];u.push({font:"72px Arial Black",color:"white",anchor:{x:.5,y:.5},textAlign:"center"});u.push({font:"48px Arial",color:"yellow",anchor:{x:.5,y:.5},textAlign:"center"});u.push({font:"24px Arial",color:"white",anchor:{x:0,y:0},textAlign:"left"});u.push({font:"80px Arial",color:"white",anchor:{x:.5,y:.5},textAlign:"center"});u.push({font:"180px Arial",color:"white",anchor:{x:.5,y:.5},textAlign:"center"});u.push({font:"20px Arial",color:"black",anchor:{x:0,y:0},textAlign:"left"});u.push({font:"48px Arial Black",color:"Black",anchor:{x:.5,y:0},textAlign:"center"});u.push({font:"32px Arial",color:"Black",anchor:{x:.5,y:0},textAlign:"center"});const a={yearLength:10,gameWidth:0,gameHeight:0,age:[10,30],wage:[10,30,5],ageBishop:[20,30],productionMatrix:[[0,0,0],[400,600,100],[-15,-5,3],[0,0,0],[-20,-10,3],[0,0,0],[-15,-5,3],[10,30,5],[-10,-5,3],[10,20,5],[0,0,0],[20,60,7]],reputationMatrix:[["",""],["",""],["Inefficient","Efficient"],["",""],["Inefficient","Efficient"],["",""],["Hungry","Small Appetite"],["Lazy","Hard working"],["Inefficient","Efficient"],["Lazy","Hard working"],["",""],["Lazy","Hard working"]],marketPriceMatrix:[[10,30],[10,30]],averageLifeExpectancy:35,curveWidthLifeExpectancy:5,workerLeaveChance:.25,newWorkerChance:.25,resourceMissingText:["Not enough money","Not enough iron","Not enough stone","Not enough bread","Not enough tools",""]},qt=["William","John","Richard","Robert","Thomas","Henry","Walter","Geoffrey","Peter","James","Simon","Roger","Stephen","Matthew","Nicholas","Gilbert","Alan","Philip","David","Hugh","Andrew","Martin","Adam","Ralph","Lawrence","Reginald","Edmund","Gilbert","Jordan","Osbert","Godfrey","Eustace","Raymond","Roland","Cuthbert","Hubert","Abelard","Baldwin","Benedict","Conrad","Frederick","Godwin","Harold","Ingram","Lancelot","Maurice","Odo","Piers","Reynold"],Kt=["🧒","👦"],Jt=["🧑","👱","👨","🧔","🧔‍♂️","👨‍🦰","👨‍🦲","🧑‍🦱","👱‍♂️"],O="Welcome to the ",rt="Frequently monitor your workers' performance by reviewing the balance in the yearbook.",ot="To manage your workers, simply click on the worker symbol located on the right. If they underperformed, fire them. Replace workers promptly when they die.",N=[O+`Market!

Here, you purchase iron for the blacksmith and stone for the masonry.

Be aware, though, that market prices fluctuate annually.`,O+`Town!

Hire skilled workers for your bakery, blacksmith, and masonry.

Each year, workers come and go; choose the best based on their reputation.`,O+`Bishop's residence!
Annually, the bishop grants funding for your cathedral project.

Review the yearbook to track your income and major events.`,O+`Bakery!

Your hired bakers produce bread for your blacksmiths and masons.

`+rt+` Insufficient funds means no bread!

`+ot,O+`Blacksmith!

Your hired blacksmiths will forge tools for the masons using the iron you've acquired.

`+rt+` Insufficient funds, bread or iron means no tools!

`+ot,O+`Masonry!

Your hired masons will use stone and tools to construct the cathedral.

`+rt+` Insufficient funds, bread, stone or tools means no progress!

`+ot];class Qt{constructor(){}generateUniform(t){return Math.random()*(t[1]-t[0])+t[0]}}const H=new Qt;class E{constructor(t){r(this,"name");r(this,"age");r(this,"wage");r(this,"emoji");r(this,"job");r(this,"jobEmoji");r(this,"production");r(this,"variation");r(this,"reputation");this.job=t,this.job=="empty"?this.name="Empty":this.name=this.getRandom(qt),this.job=="bishop"?this.age=Math.round(H.generateUniform(a.ageBishop)):this.age=Math.round(H.generateUniform(a.age)),this.setEmoji(),this.jobEmoji="🥖",this.production=[0,0,0,0,0,0],this.variation=[0,0,0,0,0,0],this.reputation=[],this.setValues()}getRandom(t){return t[Math.floor(Math.random()*t.length)]}setEmoji(){this.age<=18?this.emoji=this.getRandom(Kt):this.emoji=this.getRandom(Jt)}birthday(){this.age=this.age+1,this.age==19&&this.setEmoji()}dies(){let t=1/(1+Math.exp((-this.age+a.averageLifeExpectancy)/a.curveWidthLifeExpectancy));return Math.random()<=t}setValues(){let t=[];this.job=="baker"?t=[0,-1,-1,1,-1,-1]:this.job=="smith"?(t=[0,0,-1,0,1,-1],this.jobEmoji="⚒️"):this.job=="mason"?(t=[0,-1,0,0,0,1],this.jobEmoji="🪨"):this.job=="bishop"?t=[1,-1,-1,-1,-1,-1]:this.job=="empty"&&(t=[-1,-1,-1,-1,-1,-1]);let e=0,i=0,s=[],n=[];for(let o=0;o<t.length;o++)t[o]>-1&&(i++,s=a.productionMatrix[o*2+t[o]],n=a.reputationMatrix[o*2+t[o]],this.production[o]=Math.round(H.generateUniform(s)),this.variation[o]=s[2],this.production[o]>s[0]+.75*(s[1]-s[0])?(this.reputation.push(n[1]),e++):this.production[o]<s[0]+.25*(s[1]-s[0])&&(this.reputation.push(n[0]),e--));if(this.job!="empty"){let o=e/i;this.wage=Math.round((a.wage[0]+a.wage[1])/2+o*(a.wage[1]-a.wage[0])/2+H.generateUniform([-a.wage[2],a.wage[2]])),this.job!="bishop"&&(this.production[0]=-this.wage)}}}class Zt{constructor(){r(this,"year");r(this,"workerBalance");r(this,"overallBalance");r(this,"events");this.year=1212,this.workerBalance=[],this.overallBalance=[0,0,0,0,0,0],this.events=[];for(let t=0;t<5;t++)this.workerBalance.push(new te)}}class te{constructor(){r(this,"name");r(this,"balance");this.name="",this.balance=[0,0,0,0,0,0]}}class V{constructor(t,e,i,s,n,o,c,l,d){r(this,"name");r(this,"emoji");r(this,"description");r(this,"image");r(this,"compo");r(this,"fullYearbook");r(this,"placeType");r(this,"relevantResources");r(this,"resources");r(this,"workers");r(this,"prices");r(this,"helpString");this.fullYearbook=[],this.workers=[],this.resources=l,this.prices=[Math.round(H.generateUniform(a.marketPriceMatrix[0])),Math.round(H.generateUniform(a.marketPriceMatrix[1]))],this.helpString=d,this.name=i,this.placeType=o,this.relevantResources=c,this.emoji=s,this.description=p({text:this.name,...u[2],onDown:()=>{this.click()}}),this.image=p({text:s,...u[n],onDown:()=>{this.click()}}),this.compo=R({x:a.gameWidth*t,y:a.gameHeight*e,anchor:{x:.5,y:.5},justify:"center",children:[this.image,this.description]}),z(this.description,this.image),this.writeYearbookEntry({year:1212,workerBalance:[{name:"-",balance:[0,0,0,0,0,0]},{name:"-",balance:[0,0,0,0,0,0]},{name:"-",balance:[0,0,0,0,0,0]},{name:"-",balance:[0,0,0,0,0,0]},{name:"-",balance:[0,0,0,0,0,0]}],overallBalance:[0,0,0,0,0,0],events:["No cathedral yet!"]});for(let f=0;f<5;f++)this.workers.push(new E("empty"));this.placeType=="Bishop"&&(this.workers[0]=new E("bishop"))}click(){this.placeType!="Cathedral"&&S("clickPlace",this)}tick(t){console.log("tick: "+this.name);for(let e=0;e<this.workers.length;e++)this.workers[e].name!="Empty"&&this.workers[e].birthday();if(this.placeType=="Town"){for(let e=0;e<this.workers.length;e++)if(this.workers[e].name!="Empty"&&Math.random()<=a.workerLeaveChance&&(this.workers[e]=new E("empty")),this.workers[e].name=="Empty")switch(e){case 0:this.workers[0]=new E("baker");break;case 1:this.workers[1]=new E("smith");break;case 2:this.workers[2]=new E("mason");break;default:if(Math.random()<=a.newWorkerChance){let i=Math.random(),s;i<.33?s="baker":i<.66?s="smith":s="mason",this.workers[e]=new E(s)}}}else if(this.placeType=="Market")this.prices=[Math.round(H.generateUniform(a.marketPriceMatrix[0])),Math.round(H.generateUniform(a.marketPriceMatrix[1]))];else{let e=new Zt;e.year=t;let i=[!1,!1,!1,!1,!1,!1];for(let s=0;s<this.workers.length;s++){let n=this.workers[s],o=!0,c=[0,0,0,0,0,0];n.job=="empty"?e.workerBalance[s].name="-":e.workerBalance[s].name=n.name;for(let l=0;l<n.production.length;l++)this.relevantResources[l]&&(c[l]=Math.round(n.production[l]+H.generateUniform([-n.variation[l],n.variation[l]])),c[l]<0&&this.resources[l]<Math.abs(c[l])&&(i[l]=!0,o=!1));if(o){for(let l=0;l<n.production.length;l++)this.relevantResources[l]&&(this.resources[l]=this.resources[l]+c[l],e.overallBalance[l]=e.overallBalance[l]+c[l]);e.workerBalance[s].balance=c}}for(let s=0;s<i.length;s++)i[s]&&e.events.push(a.resourceMissingText[s]);for(let s=0;s<this.workers.length;s++)this.workers[s].job!="empty"&&this.workers[s].dies()&&e.events.length<9&&(this.placeType=="Bishop"?(e.events.push("Bishop "+this.workers[s].name+" passed away ☠️!"),this.workers[s]=new E("bishop"),e.events.push("Welcome Bishop "+this.workers[s].name+"!")):(e.events.push(this.workers[s].name+" died ☠️!"),this.workers[s]=new E("empty")));this.writeYearbookEntry(e)}}writeYearbookEntry(t){this.fullYearbook.push(t)}readYearbookEntry(t){for(let e=0;e<this.fullYearbook.length;e++)if(this.fullYearbook[e].year==t)return this.fullYearbook[e];return this.fullYearbook[this.fullYearbook.length-1]}yearExist(t){for(let e=0;e<this.fullYearbook.length;e++)if(t==this.fullYearbook[e].year)return!0;return!1}numberOfWorkers(){let t=0;for(let e=0;e<this.workers.length;e++)this.workers[e].job!="empty"&&t++;return t}nextEmptyWorkerSpot(){for(let t=0;t<this.workers.length;t++)if(this.workers[t].job=="empty")return t;return-1}}class nt extends J{constructor(e){super({x:e.x,y:e.y});r(this,"properties");r(this,"length");this.properties=e,this.length=this.properties.length}draw(){this.context.strokeStyle=this.properties.color,this.context.beginPath(),this.context.moveTo(0,0),this.properties.horizontal?this.context.lineTo(this.properties.length,0):this.context.lineTo(0,this.properties.length),this.context.lineWidth=this.properties.width,this.context.stroke()}}class pt extends F{constructor(e,i,s,n){super({x:e,y:i,color:"blue",onDown:n});r(this,"text");this.text=p({text:s,...u[2],anchor:{x:.5,y:.5}}),this.width=this.text.width+2*a.gameWidth*.01,this.height=this.text.height+2*a.gameWidth*.005,this.text.x=this.width/2,this.text.y=this.height/2,this.addChild(this.text),z(this)}setText(e){this.text.text=e}onDown(){}}class ee extends F{constructor(){super({x:0,y:0,width:0,height:0});r(this,"shadow");r(this,"cover");r(this,"page");r(this,"lineSeparator");r(this,"year");r(this,"showYear");r(this,"showLinesLeft");r(this,"showLinesRight");r(this,"linesLeft");r(this,"linesRight");r(this,"showTextLeft");r(this,"showTextRight");r(this,"showBuyButtons");r(this,"textRight");r(this,"textLeft");r(this,"buyButtons");r(this,"textRightGrid");r(this,"textLeftGrid");r(this,"buyButtonsGrid");r(this,"showNextButton");r(this,"showPreviousButton");r(this,"nextButton");r(this,"previousButton");this.year=[],this.showYear=!0,this.showLinesLeft=!0,this.showLinesRight=!0,this.showTextRight=!0,this.showTextLeft=!0,this.showBuyButtons=!0,this.showNextButton=!0,this.showPreviousButton=!0;let e=a.gameWidth*.01,i=a.gameWidth*.01,s=9,n=[a.gameHeight*.03,a.gameHeight*.02,a.gameHeight*.12,a.gameHeight*.07];this.cover=D({x:a.gameWidth*.01,y:a.gameHeight*.12,width:a.gameWidth*.9,height:a.gameHeight*.85,color:"#4A0404"}),this.shadow=D({x:this.cover.x+e,y:this.cover.y+e,width:this.cover.width,height:this.cover.height,color:"black",opacity:.3}),this.page=D({x:this.cover.x+i,y:this.cover.y+i/2,width:this.cover.width-2*i,height:this.cover.height-i,color:"#E1C16E"}),this.lineSeparator=new nt({x:this.cover.x+this.cover.width/2,y:this.page.y,length:this.page.height,horizontal:!1,width:1,color:"black"});for(let y=0;y<2;y++)this.year.push(p({x:this.page.x+this.page.width*(.25+.5*y),y:this.page.y+n[0],text:"1213",...u[7]}));this.addChild([this.shadow,this.cover,this.page,this.lineSeparator]);let o=[],c=[],l=this.page.x+2*i,d=this.page.width/2-4*i,f={x:0,y:0,horizontal:!0,width:1,color:"black"};for(let y=0;y<s;y++)o.push(new nt({...f,length:d})),c.push(new nt({...f,length:d}));this.linesLeft=R({x:l,y:this.year[0].y+this.year[0].height+n[2],rowGap:n[3],children:o}),this.linesRight=R({x:l+d+4*i,y:this.year[0].y+this.year[0].height+n[2],rowGap:n[3],children:c}),this.textRight=[],this.textLeft=[];let g=7,x={x:0,y:0,text:"t",...u[5]};for(let y=0;y<s;y++){this.textRight.push(p(x));for(let C=0;C<g;C++)this.textLeft.push(p(x))}let b=this.linesLeft.y-Number(this.linesLeft.rowGap)*.75,_=Number(this.linesLeft.rowGap)-this.textLeft[0].height,L=a.gameWidth*.01;this.textRightGrid=R({x:this.linesRight.x,y:b,rowGap:_,children:this.textRight}),this.textLeftGrid=R({x:this.linesLeft.x,y:b,rowGap:_,colGap:L,numCols:g,flow:"grid",justify:["start","end","end","end","end","end","end"],children:this.textLeft});let W=a.gameHeight*.04,w=a.gameWidth*.01;this.buyButtons=[];let m=[10,100,10,100],j=[1,1,2,2],k="🧲";for(let y=0;y<4;y++)this.buyButtons.push(new pt(0,0,"Buy "+String(m[y])+k,()=>{S("buy",j[y],m[y])})),this.buyButtons.push(p({text:"for 100",...u[2],color:"black"})),y==1&&(this.buyButtons.push(p({text:""}),p({text:""})),k="🪨");this.buyButtonsGrid=R({x:this.linesRight.x+a.gameWidth*.1,y:this.linesRight.y-a.gameHeight*.05,rowGap:W,colGap:w,numCols:2,flow:"grid",justify:"center",children:this.buyButtons});let B=.01*a.gameWidth;this.previousButton=p({x:this.page.x+B,y:this.page.y+B,text:"⬅️",...u[6],anchor:{x:0,y:0},onDown:()=>{S("previousButton")}}),this.nextButton=p({x:this.page.x+this.page.width-B,y:this.page.y+B,text:"➡️",...u[6],anchor:{x:1,y:0},onDown:()=>{S("nextButton")}}),z(this.previousButton,this.nextButton)}update(){super.update(),this.textLeftGrid.update()}render(){if(super.render(),this.showYear)for(let e=0;e<this.year.length;e++)this.year[e].render();this.showLinesLeft&&this.linesLeft.render(),this.showLinesRight&&this.linesRight.render(),this.showTextRight&&this.textRightGrid.render(),this.showTextLeft&&this.textLeftGrid.render(),this.showPreviousButton&&this.previousButton.render(),this.showNextButton&&this.nextButton.render(),this.showBuyButtons&&this.buyButtonsGrid.render()}setupPages(e,i,s,n,o,c,l,d,f){for(let g=0;g<this.year.length;g++)this.year[g].text=String(e);if(this.showYear=i,this.showLinesLeft=s,this.showLinesRight=n,this.showTextRight=c,this.showTextLeft=o,this.showBuyButtons=l,this.showTextRight)for(let g=0;g<this.textRight.length;g++)g<f.length?this.textRight[g].text=f[g]:this.textRight[g].text="";if(this.showTextLeft)for(let g=0;g<this.textLeft.length;g++)g<d.length?this.textLeft[g].text=d[g]:this.textLeft[g].text=""}}class _t extends F{constructor(e,i){super({x:e,y:a.gameHeight*.12,width:a.gameWidth*.17,height:a.gameHeight*.85,color:"#E1C16E"});r(this,"shadow");r(this,"background");r(this,"name");r(this,"picture");r(this,"job");r(this,"age");r(this,"wage");r(this,"characteristics");r(this,"reputation");r(this,"hireFireButton");r(this,"hireFireButtonVisible");r(this,"tilePosition");this.hireFireButtonVisible=!1,this.tilePosition=i;let s=a.gameWidth*.008,n=[a.gameHeight*.02,a.gameHeight*.05,a.gameHeight*.02,a.gameHeight*.01],o=[a.gameWidth*.01];this.name=p({x:this.width/2,y:n[0],text:"",...u[7]}),this.shadow=D({x:s,y:s,width:this.width,height:this.height,color:"black",opacity:.3}),this.background=D({x:0,y:0,width:this.width,height:this.height,color:this.color}),this.picture=p({x:this.width/2,y:this.name.y+this.name.height+n[1],text:"",...u[3],anchor:{x:.5,y:0}}),this.job=p({text:"",...u[5]}),this.age=p({text:"",...u[5]}),this.wage=p({text:"",...u[5]});let c=R({x:o[0],y:this.picture.y+this.picture.height+n[1]/2,justify:"start",children:[p({text:"Job:",...u[5]}),p({text:"Age:",...u[5]}),p({text:"Wage:",...u[5]})],rowGap:n[3]});this.characteristics=R({x:this.width-o[0],y:c.y,justify:"end",anchor:{x:1,y:0},children:[this.job,this.age,this.wage],rowGap:c.rowGap});let l=p({x:c.x,y:c.y+c.height+n[1]/2,text:"Reputation:",...u[5],width:this.width-2*o[0]});this.reputation=p({x:l.x,y:l.y+l.height,text:"",...u[5],width:this.width-2*o[0]}),this.hireFireButton=new pt(0,0,"Hire",()=>{this.clickButton()}),this.hireFireButton.x=this.x+this.width/2-this.hireFireButton.width/2,this.hireFireButton.y=this.y+this.height-n[2]-this.hireFireButton.height,this.addChild([this.shadow,this.background,this.name,this.picture,c,this.characteristics,l,this.reputation])}render(){super.render(),this.hireFireButtonVisible&&this.hireFireButton.render()}hideButton(){this.hireFireButtonVisible=!1}showButton(e){this.hireFireButtonVisible=!0,this.hireFireButton.setText(e)}clickButton(){S("hireFire",this.tilePosition)}}class ie extends F{constructor(){super({x:0,y:0,width:0,height:0});r(this,"tiles");let e=a.gameWidth*.01;this.tiles=[],this.tiles.push(new _t(e,0));let i=this.tiles[0].width+a.gameWidth*.01;for(let s=1;s<5;s++)this.tiles.push(new _t(this.tiles[s-1].x+i,s));this.addChild(this.tiles)}setWorkerTiles(e,i){for(let s=0;s<e.length;s++)if(this.tiles[s].name.text=e[s].name,e[s].name!="Empty"){if(this.tiles[s].picture.text=e[s].emoji,this.tiles[s].job.text=e[s].jobEmoji,this.tiles[s].age.text=String(e[s].age),this.tiles[s].wage.text=String(e[s].wage),e[s].reputation.length<=0)this.tiles[s].reputation.text="-";else{let n=e[s].reputation[0];for(let o=1;o<e[s].reputation.length;o++)n=n+", "+e[s].reputation[o];this.tiles[s].reputation.text=n}i=="Town"?this.tiles[s].showButton("Hire"):this.tiles[s].showButton("Fire")}else this.tiles[s].picture.text="⬜",this.tiles[s].job.text="-",this.tiles[s].age.text="-",this.tiles[s].wage.text="-",this.tiles[s].reputation.text="-",this.tiles[s].hideButton()}}class se extends F{constructor(e){super({x:0,y:0,width:a.gameWidth,height:a.gameHeight,color:"#EADDCA"});r(this,"visible");r(this,"bookVisible");r(this,"workersVisible");r(this,"workerButtonVisible");r(this,"bookButtonVisible");r(this,"title");r(this,"cancelButton");r(this,"helpButton");r(this,"book");r(this,"workers");r(this,"workerButton");r(this,"bookButton");r(this,"place");this.place=e,this.visible=!1,this.bookVisible=!0,this.workersVisible=!1,this.bookButtonVisible=!1,this.workerButtonVisible=!0,this.book=new ee,this.workers=new ie,this.title=p({x:this.width/2,y:a.gameHeight*.02,text:"Title",...u[6]}),this.cancelButton=p({x:a.gameWidth*.96,y:a.gameWidth*.01,text:"✖️",...u[6],onDown:()=>{this.hide()}}),this.helpButton=p({x:this.cancelButton.x,y:a.gameHeight-a.gameHeight*.08,text:"❓",...u[6],anchor:{x:.5,y:.5},onDown:()=>{S("showHelp",this.place)}}),z(this.cancelButton,this.helpButton),this.addChild([this.title,this.cancelButton,this.helpButton]),this.workerButton=p({x:this.cancelButton.x,y:this.book.page.y+this.book.page.height/2,text:"🧔‍♂️",...u[6],anchor:{x:.5,y:.5},onDown:()=>{this.bookVisible=!1,this.workersVisible=!0,this.workerButtonVisible=!1,this.bookButtonVisible=!0}}),this.bookButton=p({x:this.workerButton.x,y:this.workerButton.y,text:"📙",...u[6],anchor:{x:.5,y:.5},onDown:()=>{this.bookVisible=!0,this.workersVisible=!1,this.workerButtonVisible=!0,this.bookButtonVisible=!1}}),z(this.workerButton,this.bookButton),T("previousButton",()=>{this.fillPageWorkshop(Number(this.book.year[0].text)-1)}),T("nextButton",()=>{this.fillPageWorkshop(Number(this.book.year[0].text)+1)})}update(){super.update(),this.book.update(),this.workers.setWorkerTiles(this.place.workers,this.place.placeType),this.workers.update(),this.book.showPreviousButton=this.place.yearExist(Number(this.book.year[0].text)-1),this.book.showNextButton=this.place.yearExist(Number(this.book.year[0].text)+1),this.place.placeType=="Market"&&this.fillPageMarket()}render(){this.visible&&(super.render(),this.bookVisible&&this.book.render(),this.workersVisible&&this.workers.render(),this.bookButtonVisible&&this.bookButton.render(),this.workerButtonVisible&&this.workerButton.render())}show(e,i){this.visible=!0,this.place=e,this.title.text=this.place.name+" "+this.place.emoji,this.place.placeType=="Workshop"?(this.bookVisible=!0,this.workersVisible=!1,this.workerButtonVisible=!0,this.bookButtonVisible=!1,this.fillPageWorkshop(i)):this.place.placeType=="Bishop"?(this.bookVisible=!0,this.workersVisible=!1,this.workerButtonVisible=!1,this.bookButtonVisible=!1,this.fillPageWorkshop(i)):this.place.placeType=="Market"?(this.bookVisible=!0,this.workersVisible=!1,this.workerButtonVisible=!1,this.bookButtonVisible=!1,this.fillPageMarket()):this.place.placeType=="Town"&&(this.bookVisible=!1,this.workersVisible=!0,this.workerButtonVisible=!1,this.bookButtonVisible=!1),this.workers.setWorkerTiles(this.place.workers,this.place.placeType)}hide(){this.visible=!1}fillPageWorkshop(e){let i=this.place.readYearbookEntry(e),s=this.place.relevantResources,n=["🪙","🧲","🪨","🥖","⚒️","⛪"],o=[];o.push("Balance:","","","","","","","");for(let l=0;l<s.length;l++)s[l]?o.push(n[l]):o.push(" ");for(let l=0;l<i.workerBalance.length;l++)if(this.place.placeType=="Bishop"&&i.workerBalance[l].name=="-")o.push("","","","","","","");else{o.push(i.workerBalance[l].name);for(let d=0;d<i.workerBalance[l].balance.length;d++)s[d]?o.push(String(i.workerBalance[l].balance[d])):o.push(" ")}o.push("","","","","","",""),o.push("Overall:");for(let l=0;l<i.overallBalance.length;l++)s[l]?o.push(String(i.overallBalance[l])):o.push("");let c=[];c.push("Events:");for(let l=0;l<i.events.length;l++)c.push(i.events[l]);this.book.setupPages(i.year,!0,!0,!0,!0,!0,!1,o,c)}fillPageMarket(){let e=["Your Resources:","","","","","","","","🪙:",String(this.place.resources[0]),"","","","","","🧲:",String(this.place.resources[1]),"","","","","","🪨:",String(this.place.resources[2]),"","","","","","🥖:",String(this.place.resources[3]),"","","","","","⚒️:",String(this.place.resources[4]),"","","",""];this.book.setupPages(1212,!1,!0,!1,!0,!1,!0,e,[""]),this.book.buyButtons[1].text="for "+String(this.place.prices[0])+"🪙",this.book.buyButtons[3].text="for "+String(this.place.prices[0]*10)+"🪙",this.book.buyButtons[7].text="for "+String(this.place.prices[1])+"🪙",this.book.buyButtons[9].text="for "+String(this.place.prices[1]*10)+"🪙"}}class he extends F{constructor(){super({x:a.gameWidth*.5,y:a.gameHeight*.5,width:a.gameWidth*.5,height:a.gameHeight*.75});r(this,"visible");r(this,"background");r(this,"shadow");r(this,"text");r(this,"button");r(this,"textDistance");r(this,"buttonDistance");this.visible=!1;let e=a.gameWidth*.01;this.buttonDistance=a.gameHeight*.03,this.textDistance=a.gameWidth*.005,this.background=D({x:0,y:0,width:this.width,height:this.height,color:"#4A0404"}),this.shadow=D({x:e,y:e,width:this.width,height:this.height,color:"black",opacity:.3}),this.text=p({x:this.textDistance,y:this.textDistance,text:"Hello",...u[2],width:this.width-2*this.textDistance}),this.button=new pt(0,0,"OK",()=>{this.clickButton()}),this.addChild([this.shadow,this.background,this.text,this.button])}clickButton(){this.visible=!1,S("popupClick")}update(){super.update()}render(){this.visible&&super.render()}show(e){this.visible=!0,this.text.text=e,this.text.render(),this.height=this.text.height+this.textDistance+2*this.buttonDistance+this.button.height,this.background.height=this.height,this.shadow.height=this.height,this.x=a.gameWidth*.5-this.width/2,this.y=a.gameHeight*.5-this.height/2,this.button.x=this.width/2-this.button.width/2,this.button.y=this.text.y+this.text.height+this.buttonDistance}}class re extends $t{constructor(e){super({id:e});r(this,"gameState");r(this,"resourcesText");r(this,"resources");r(this,"places");r(this,"cathedral");r(this,"year");r(this,"progressText");r(this,"tickLength");r(this,"lastTickTime");r(this,"nextTick");r(this,"insidePlace");r(this,"popup");r(this,"helpString");r(this,"helpButton")}onShow(){this.gameState=-1,this.helpString=`Welcome to the 13th century, a time when magnificent cathedrals adorn the skyline of every major city, except yours.

You've been appointed as the CATHEDRAL MASTER BUILDER by the bishop to complete the construction of the cathedral before the century's end.

The bishop provides money for your project. Visit the TOWN to recruit skilled workers for your BAKERY, BLACKSMITH, and MASONRY. Procure iron and stone from the MARKET.
For detailed guidance and information, explore each location.`,this.helpButton=p({x:a.gameWidth*.96,y:a.gameHeight-a.gameHeight*.08,text:"❓",...u[6],anchor:{x:.5,y:.5},onDown:()=>{S("showHelp")}}),z(this.helpButton),this.year=p({text:"1213",...u[0],x:a.gameWidth*.55,y:a.gameHeight*.1}),this.resourcesText=R({x:a.gameWidth*.01,y:a.gameWidth*.01,rowGap:a.gameHeight*.02,colGap:0,numCols:2,flow:"grid",children:[p({text:"🪙: ",...u[2]}),p({text:"0",...u[2]}),p({text:"🧲: ",...u[2]}),p({text:"0",...u[2]}),p({text:"🪨: ",...u[2]}),p({text:"0",...u[2]}),p({text:"🥖: ",...u[2]}),p({text:"0",...u[2]}),p({text:"⚒️: ",...u[2]}),p({text:"0",...u[2]})]}),this.resources=[0,0,0,0,0,0],this.places=[],this.places.push(new V(.05,.55,"Market","🧺",3,"Market",[!1,!1,!1,!1,!1,!1],this.resources,N[0])),this.places.push(new V(.05,.85,"Town","🏘️",3,"Town",[!1,!1,!1,!1,!1,!1],this.resources,N[1])),this.places.push(new V(.25,.75,"Bishop","✝️",3,"Bishop",[!0,!1,!1,!1,!1,!1],this.resources,N[2])),this.places.push(new V(.37,.35,"Bakery","🥖",3,"Workshop",[!0,!1,!1,!0,!1,!1],this.resources,N[3])),this.places.push(new V(.73,.35,"Blacksmith","⚒️",3,"Workshop",[!0,!0,!1,!0,!0,!1],this.resources,N[4])),this.places.push(new V(.85,.75,"Masonry","🪨",3,"Workshop",[!0,!1,!0,!0,!0,!0],this.resources,N[5])),this.cathedral=new V(.55,.63,"Cathedral","⛪",4,"Cathedral",[!1,!1,!1,!1,!1,!1],this.resources,""),this.progressText=p({text:"0 / 10000",...u[1],color:"white",x:a.gameWidth*.55,y:a.gameHeight*.9}),this.insidePlace=new se(this.places[1]),this.popup=new he,this.add([this.year,this.resourcesText,this.cathedral.compo,this.progressText,this.helpButton]);for(let e of this.places)this.add(e.compo);this.add([this.insidePlace,this.popup]),T("clickPlace",e=>{!this.insidePlace.visible&&!this.popup.visible&&this.insidePlace.show(e,Number(this.year.text))}),T("hireFire",e=>{this.hireFire(e)}),T("buy",(e,i)=>{this.buyResources(e,i)}),T("showHelp",e=>{this.showHelp(e)}),T("popupClick",()=>{this.gameState==-1?this.gameState=0:this.gameState==1&&(this.hide(),this.show())}),this.tickLength=Math.round(a.yearLength*1e3/this.places.length),this.lastTickTime=Date.now()-this.tickLength,this.nextTick=0,this.popup.show(this.helpString)}onHide(){}update(){super.update(),this.gameState==0&&Date.now()-this.lastTickTime>this.tickLength&&(this.lastTickTime=Date.now(),this.places[this.nextTick].tick(Number(this.year.text)),this.nextTick++,this.nextTick>=this.places.length&&(this.nextTick=0,this.year.text=String(Number(this.year.text)+1)));for(let e=0;e<this.resources.length-1;e++)this.resourcesText.children[e*2+1].text=String(this.resources[e]);this.resources[5]>=1e4&&Number(this.year.text)<=1300?(this.gameState=1,this.popup.show(`Congratulations!

You've completed the cathedral before the 13th century's close (`+this.year.text+`), restoring your city's glory and earning the bishop's pride!

Play again?`)):this.resources[5]>=1e4&&(this.gameState=1,this.popup.show("The cathedral is finally completed, but alas, it's a bit too late ("+this.year.text+`).

The 13th century has already come to an end, and other cities have stolen the spotlight with their faster progress.

 Play again?`)),this.progressText.text=String(this.resources[5])+" / 10000"}render(){super.render()}hireFire(e){let i=this.insidePlace.place;if(i.name=="Town"){let s;switch(this.places[1].workers[e].job){case"baker":s=this.places[3];break;case"smith":s=this.places[4];break;default:s=this.places[5]}s.nextEmptyWorkerSpot()==-1?this.popup.show("You have already 5 workers in the "+s.name):(s.workers[s.nextEmptyWorkerSpot()]=i.workers[e],i.workers[e]=new E("empty"))}else i.workers[e]=new E("empty")}buyResources(e,i){let s=this.places[0].prices[e-1]*i/10;s<=this.resources[0]?(this.resources[0]=this.resources[0]-s,this.resources[e]=this.resources[e]+i):this.popup.show("Not enough money!")}showHelp(e){let i="";typeof e<"u"?i=e.helpString:i=this.helpString,this.popup.show(i)}}let{canvas:I,context:ae}=Mt();Nt();a.gameWidth=I.width;a.gameHeight=I.height;addEventListener("resize",Lt);Lt();const ct=new re("game");let oe=It({update:function(){ct.update()},render:function(){ct.render()}});ct.show();oe.start();function Lt(){let h=a.gameWidth/a.gameHeight;window.innerWidth/h>window.innerHeight?(I.style.height=String(window.innerHeight)+"px",I.style.width=String(window.innerHeight*h)+"px"):(I.style.width=String(window.innerWidth)+"px",I.style.height=String(window.innerWidth/h)+"px")}
