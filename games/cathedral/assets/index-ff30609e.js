var wt=Object.defineProperty;var xt=(i,t,e)=>t in i?wt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var M=(i,t,e)=>(xt(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();/**
 * @preserve
 * Kontra.js v9.0.0
 */let q=()=>{},yt="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function st(i,t){let e=t.parentNode;if(i.setAttribute("data-kontra",""),e){let s=e.querySelector("[data-kontra]:last-of-type")||t;e.insertBefore(i,s.nextSibling)}else document.body.appendChild(i)}function ct(i,t){let e=i.indexOf(t);if(e!=-1)return i.splice(e,1),!0}let F={};function R(i,t){F[i]=F[i]||[],F[i].push(t)}function mt(i,t){F[i]=(F[i]||[]).filter(e=>e!=t)}function z(i,...t){(F[i]||[]).map(e=>e(...t))}let X,B,nt={get(i,t){return t=="_proxy"?!0:q}};function dt(){return X}function O(){return B}function St(i,{contextless:t=!1}={}){if(X=document.getElementById(i)||i||document.querySelector("canvas"),t&&(X=X||new Proxy({},nt)),!X)throw Error("You must provide a canvas element for the game");return B=X.getContext("2d")||new Proxy({},nt),B.imageSmoothingEnabled=!1,z("init"),{canvas:X,context:B}}function Ct(i,t){let e=Math.sin(t),s=Math.cos(t);return{x:i.x*s-i.y*e,y:i.x*e+i.y*s}}function Z(i,t,e){return Math.min(Math.max(i,e),t)}function Ht(i,t){return[i,t]=[i,t].map(e=>ut(e)),i.x<t.x+t.width&&i.x+i.width>t.x&&i.y<t.y+t.height&&i.y+i.height>t.y}function ut(i){let{x:t=0,y:e=0,width:s,height:n}=i.world||i;return i.mapwidth&&(s=i.mapwidth,n=i.mapheight),i.anchor&&(t-=s*i.anchor.x,e-=n*i.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(e+=n,n*=-1),{x:t,y:e,width:s,height:n}}class v{constructor(t=0,e=0,s={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new v(this.x+t.x,this.y+t.y,this)}subtract(t){return new v(this.x-t.x,this.y-t.y,this)}scale(t){return new v(this.x*t,this.y*t)}normalize(t=this.length()||1){return new v(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,s,n){this._c=!0,this._a=t,this._b=e,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Z(this._a,this._d,t):t}set y(t){this._y=this._c?Z(this._b,this._e,t):t}}function N(){return new v(...arguments)}class At{constructor(t){return this.init(t)}init(t={}){this.position=N(),this.velocity=N(),this.acceleration=N(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class j extends At{init({width:t=0,height:e=0,context:s=O(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:o={x:0,y:0},opacity:u=1,rotation:l=0,scaleX:a=1,scaleY:w=1,...d}={}){this._c=[],super.init({width:t,height:e,context:s,anchor:o,opacity:u,rotation:l,scaleX:a,scaleY:w,...d}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r,R("init",()=>{this.context??(this.context=O())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(e||s)&&t.translate(e,s),this.context.globalAlpha=this.opacity,this._rf(),(e||s)&&t.translate(-e,-s),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:s=1,_wr:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:o,y:u}=Ct({x:this._wx,y:this._wy},n);this._wx=o,this._wy=u,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||q,e._pc()})}removeChild(...t){t.flat().map(e=>{ct(this.children,e)&&(e.parent=null,e._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=Z(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}let Et=/(\d+)(\w+)/;function Mt(i){if(!i)return{computed:0};let t=i.match(Et),e=+t[1],s=t[2];return{size:e,unit:s,computed:e}}class Ot extends j{init({text:t="",textAlign:e="",lineHeight:s=1,font:n=(h=>(h=O())==null?void 0:h.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:s,font:n,...r}),this.context&&this._p(),R("init",()=>{this.font??(this.font=O().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Mt(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(s=>{let n=s.split(" "),r=n.shift(),h=r;n.map(o=>{h+=" "+o,t.measureText(h).width>this._fw&&(this._s.push(r),h=o),r=h}),this._s.push(h)}),!this._s.length&&this.text.includes(`
`)){let s=0;e.map(n=>{this._s.push(n),s=Math.max(s,t.measureText(n).width)}),this._w=this._fw||s}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,s=this.context;e=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((n,r)=>{s.textBaseline="top",s.textAlign=e,s.fillStyle=this.color,s.font=this.font,this.strokeColor&&(s.strokeStyle=this.strokeColor,s.lineWidth=this.lineWidth??1,s.strokeText(n,t,this._fs*this.lineHeight*r)),s.fillText(n,t,this._fs*this.lineHeight*r)})}}function A(){return new Ot(...arguments)}let T=new WeakMap,rt={},tt={},ft={0:"left",1:"middle",2:"right"};function Yt(i,t){let{x:e,y:s,width:n,height:r}=ut(i);do e-=i.sx||0,s-=i.sy||0;while(i=i.parent);let h=t.x-Math.max(e,Math.min(t.x,e+n)),o=t.y-Math.max(s,Math.min(t.y,s+r));return h*h+o*o<t.radius*t.radius}function Wt(i){let t=i._lf.length?i._lf:i._cf;for(let e=t.length-1;e>=0;e--){let s=t[e];if(s.collidesWithPointer?s.collidesWithPointer(i):Yt(s,i))return s}}function x(i,t){return parseFloat(i.getPropertyValue(t))||0}function Xt(i){let{canvas:t,_s:e}=i,s=t.getBoundingClientRect(),n=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(n[0]),h=parseFloat(n[3]),o=(x(e,"border-left-width")+x(e,"border-right-width"))*r,u=(x(e,"border-top-width")+x(e,"border-bottom-width"))*h,l=(x(e,"padding-left")+x(e,"padding-right"))*r,a=(x(e,"padding-top")+x(e,"padding-bottom"))*h;return{scaleX:(s.width-o-l)/t.width,scaleY:(s.height-u-a)/t.height,offsetX:s.left+(x(e,"border-left-width")+x(e,"padding-left"))*r,offsetY:s.top+(x(e,"border-top-width")+x(e,"padding-top"))*h}}function ht(i){let t=i.button!=null?ft[i.button]:"left";tt[t]=!0,et(i,"onDown")}function Q(i){let t=i.button!=null?ft[i.button]:"left";tt[t]=!1,et(i,"onUp")}function ot(i){et(i,"onOver")}function Lt(i){let t=T.get(i.target);t._oo=null,tt={}}function lt(i,t,e){let s=Wt(i);s&&s[t]&&s[t](e),rt[t]&&rt[t](e,s),t=="onOver"&&(s!=i._oo&&i._oo&&i._oo.onOut&&i._oo.onOut(e),i._oo=s)}function et(i,t){i.preventDefault();let e=i.target,s=T.get(e),{scaleX:n,scaleY:r,offsetX:h,offsetY:o}=Xt(s);i.type.includes("touch")?(Array.from(i.touches).map(({clientX:l,clientY:a,identifier:w})=>{let d=s.touches[w];d||(d=s.touches[w]={start:{x:(l-h)/n,y:(a-o)/r}},s.touches.length++),d.changed=!1}),Array.from(i.changedTouches).map(({clientX:l,clientY:a,identifier:w})=>{let d=s.touches[w];d.changed=!0,d.x=s.x=(l-h)/n,d.y=s.y=(a-o)/r,lt(s,t,i),z("touchChanged",i,s.touches),t=="onUp"&&(delete s.touches[w],s.touches.length--,s.touches.length||z("touchEnd"))})):(s.x=(i.clientX-h)/n,s.y=(i.clientY-o)/r,lt(s,t,i))}function vt({radius:i=5,canvas:t=dt()}={}){let e=T.get(t);if(!e){let s=window.getComputedStyle(t);e={x:0,y:0,radius:i,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:s},T.set(t,e)}return t.addEventListener("mousedown",ht),t.addEventListener("touchstart",ht),t.addEventListener("mouseup",Q),t.addEventListener("touchend",Q),t.addEventListener("touchcancel",Q),t.addEventListener("blur",Lt),t.addEventListener("mousemove",ot),t.addEventListener("touchmove",ot),e._t||(e._t=!0,R("tick",()=>{e._lf.length=0,e._cf.map(s=>{e._lf.push(s)}),e._cf.length=0})),e}function pt(...i){i.flat().map(t=>{let e=t.context?t.context.canvas:dt(),s=T.get(e);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){s._cf.push(this),this._r()},s._o.push(t))})}function bt(i){let t=i.canvas;i.clearRect(0,0,t.width,t.height)}function Ft({fps:i=60,clearCanvas:t=!0,update:e=q,render:s,context:n=O(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let h=0,o=1e3/i,u=1/i,l=t?bt:q,a,w,d,p,g,C=!0;r||(window.addEventListener("focus",()=>{C=!0}),window.addEventListener("blur",()=>{C=!1})),R("init",()=>{g.context??(g.context=O())});function H(){if(w=requestAnimationFrame(H),!!C&&(d=performance.now(),p=d-a,a=d,!(p>1e3))){for(z("tick"),h+=p;h>=o;)g.update(u),h-=o;l(g.context),g.render()}}return g={update:e,render:s,isStopped:!0,context:n,start(){a=performance.now(),this.isStopped=!1,requestAnimationFrame(H)},stop(){this.isStopped=!0,cancelAnimationFrame(w)},_frame:H,set _last(c){a=c}},g}let Pt={set(i,t,e){return t.startsWith("_")||(i._d=!0),Reflect.set(i,t,e)}},at={start(i){return i?1:0},center(){return .5},end(i){return i?0:1}};class kt extends j{init({flow:t="column",align:e="start",justify:s="start",colGap:n=0,rowGap:r=0,numCols:h=1,dir:o="",breakpoints:u=[],...l}={}){return super.init({flow:t,align:e,justify:s,colGap:n,rowGap:r,numCols:h,dir:o,breakpoints:u,...l}),this._p(),new Proxy(this,Pt)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(c=>{c.metric.call(this)&&this._b!==c&&(this._b=c,c.callback.call(this))});let t=this._g=[],e=this._cw=[],s=this._rh=[],n=this.children,r=this._nc=this.flow=="column"?1:this.flow=="row"?n.length:this.numCols,h=0,o=0;for(let c=0,f;f=n[c];c++){t[h]=t[h]||[],f._p&&f._p();let{width:$,height:_}=f.world||f;s[h]=Math.max(s[h]||0,_);let S=f.colSpan||1,L=S;do e[o]=Math.max(e[o]||0,$/L),t[h][o]=f;while(o++<=r&&--S);o>=r&&(o=0,h++)}for(;o>0&&o<r;)t[h][o++]=!1;let u=t.length,l=[].concat(this.colGap),a=[].concat(this.rowGap);this._w=e.reduce((c,f)=>c+=f,0);for(let c=0;c<r-1;c++)this._w+=l[c%l.length];this._h=s.reduce((c,f)=>c+=f,0);for(let c=0;c<u-1;c++)this._h+=a[c%a.length];this._uw();let d=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=d,d&&(this._g=t.map(c=>c.reverse()),this._cw=e.reverse(),l=l.reverse());let p=-this.anchor.y*this.height,g=[],C=[].concat(this.justify),H=[].concat(this.align);this._g.map((c,f)=>{let $=-this.anchor.x*this.width;c.map((_,S)=>{if(_&&!g.includes(_)){g.push(_);let L=at[_.justifySelf||C[S%C.length]](this._rtl),D=at[_.alignSelf||H[f%H.length]](),U=_.colSpan||1,it=e[S];if(U>1&&S+U<=this._nc)for(let E=1;E<U;E++)it+=e[S+E]+l[(S+E)%l.length];let Y=it*L,W=s[f]*D,k=0,G=0,{width:K,height:J}=_.world||_;if(_.anchor&&(k=_.anchor.x,G=_.anchor.y),L==0)Y=Y+K*k;else if(L==.5){let E=k<.5?-1:k==.5?0:1;Y=Y+E*K*L}else Y=Y-K*(1-k);if(D==0)W=W+J*G;else if(D==.5){let E=G<.5?-1:G==.5?0:1;W=W+E*J*D}else W=W-J*(1-G);_.x=$+Y,_.y=p+W}$+=e[S]+l[S%l.length]}),p+=s[f]+a[f%a.length]})}}function _t(){return new kt(...arguments)}function V(i){let t=[];return i._dn?t.push(i._dn):i.children&&i.children.map(e=>{t=t.concat(V(e))}),t}class I{constructor({id:t,name:e=t,objects:s=[],context:n=O(),cullObjects:r=!0,cullFunction:h=Ht,sortFunction:o,...u}){this._o=[],Object.assign(this,{id:t,name:e,context:n,cullObjects:r,cullFunction:h,sortFunction:o,...u});let l=this._dn=document.createElement("section");l.tabIndex=-1,l.style=yt,l.id=t,l.setAttribute("aria-label",e);let a=this;class w extends j{set x(p){a.sx=p-this.centerX,super.x=p}get x(){return super.x}set y(p){a.sy=p-this.centerY,super.y=p}get y(){return super.y}}this.camera=new w({context:n,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(s),this._i=()=>{this.context??(this.context=O());let d=this.context.canvas,{width:p,height:g}=d,C=p/2,H=g/2;Object.assign(this.camera,{centerX:C,centerY:H,x:C,y:H,width:p,height:g}),this._dn.isConnected||st(this._dn,d)},this.context&&this._i(),R("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,V(e).map(s=>{this._dn.appendChild(s)})})}remove(...t){t.flat().map(e=>{ct(this._o,e),e.parent=null,V(e).map(s=>{st(s,this.context)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){mt("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:s}=t.world||t;this.camera.x=e,this.camera.y=s}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:s,_sy:n,camera:r,sortFunction:h,cullObjects:o,cullFunction:u}=this;e.translate(s,n);let l=t;o&&(l=l.filter(a=>u(r,a))),h&&l.sort(h),l.map(a=>a.render&&a.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:s,y:n,centerX:r,centerY:h}=e;t.save(),this._sx=r-s,this._sy=h-n,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}class Gt{constructor(){M(this,"scenes");M(this,"currentScene");this.scenes=[]}init(t){this.scenes.push(...t),this.currentScene=this.scenes[0],this.currentScene.show()}start(t){this.currentScene.hide();for(let e of this.scenes)if(e.id==t){this.currentScene=e;break}this.currentScene.show()}}class Tt extends I{constructor(t){super({id:t})}onShow(){P.start("menu")}}let y=[];y.push({font:"72px Arial",color:"white",anchor:{x:.5,y:.5},textAlign:"center"});y.push({font:"48px Arial",color:"yellow",anchor:{x:.5,y:.5},textAlign:"center"});y.push({font:"24px Arial",color:"white",anchor:{x:0,y:0},textAlign:"left"});const m={gameWidth:0,gameHeight:0};class Rt extends I{constructor(t){super({id:t})}onShow(){let t=A({text:"Cathedral Master Builder",...y[0]}),e=A({text:"Start",...y[1],onDown:()=>{P.start("game")}}),s=A({text:"Credits",...y[1],onDown:()=>{console.log("Credits pressed")}});const n=m.gameHeight*.1;let r=_t({x:m.gameWidth/2,y:n*2,anchor:{x:.5,y:0},rowGap:[n*1.5,n,n],justify:"center",children:[t,e,s]});pt(e,s),this.add(r)}onHide(){}update(){super.update()}render(){super.render()}}class $t extends I{constructor(e){super({id:e});M(this,"money");M(this,"stone");M(this,"iron");M(this,"bread");M(this,"tools")}onShow(){this.money=A({text:"🪙: 0",...y[2]}),this.stone=A({text:"🪨: 0 kg",...y[2]}),this.iron=A({text:"🧲: 0 kg",...y[2]}),this.bread=A({text:"🥖: 0 pcs",...y[2]}),this.tools=A({text:"⚒️: 0 pcs",...y[2]});let e=_t({x:m.gameHeight*.01,y:m.gameWidth*.01,anchor:{x:0,y:0},rowGap:[m.gameHeight*.02],children:[this.money,this.stone,this.iron,this.bread,this.tools]});this.add(e)}onHide(){}update(){super.update()}render(){super.render()}}class Dt extends I{constructor(t){super({id:t})}onShow(){let t=A({text:"You WON!",...y[1],x:m.gameWidth/2,y:m.gameHeight/2,onDown:()=>{P.start("menu")}});pt(t),this.add(t)}onHide(){}update(){super.update()}render(){super.render()}}let{canvas:b,context:Jt}=St();vt();m.gameWidth=b.width;m.gameHeight=b.height;addEventListener("resize",gt);gt();const Bt=new Tt("loading"),qt=new Rt("menu"),zt=new $t("game"),It=new Dt("win");let P=new Gt;P.init([Bt,qt,zt,It]);let Ut=Ft({update:function(){P.currentScene.update()},render:function(){P.currentScene.render()}});Ut.start();function gt(){let i=m.gameWidth/m.gameHeight;window.innerWidth/i>window.innerHeight?(b.style.height=String(window.innerHeight)+"px",b.style.width=String(window.innerHeight*i)+"px",console.log("hey")):(b.style.width=String(window.innerWidth)+"px",b.style.height=String(window.innerWidth/i)+"px",console.log("ho"))}
